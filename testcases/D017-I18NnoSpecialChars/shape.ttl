@base <http://example.com/base/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix uq: <http://sirius−labs.no/shapes/unique#> .

# 植物
<%E6%A4%8D%E7%89%A9> a sh:NodeShape , rdfs:Class ;
    sh:property [ sh:maxLength 10 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:path <%E6%A4%8D%E7%89%A9#%E5%90%8D> ] ; 
    sh:property [ sh:maxLength 50 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:path <%E6%A4%8D%E7%89%A9#%E4%BD%BF%E7%94%A8%E9%83%A8> ] ; 
    sh:property [ sh:maxLength 50 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:maxCount 1 ;
        sh:path <%E6%A4%8D%E7%89%A9#%E6%9D%A1%E4%BB%B6> ] ; 
    sh:property [
        sh:path [
            sh:inversePath <%E6%88%90%E5%88%86,%E6%A4%8D%E7%89%A9#%E6%A4%8D%E7%89%A9%E5%90%8D,%E4%BD%BF%E7%94%A8%E9%83%A8,%E5%90%8D,%E4%BD%BF%E7%94%A8%E9%83%A8>
        ];
        sh:nodeKind sh:IRI;
        sh:class <%E6%88%90%E5%88%86>
    ];
    uq:uniqueValuesForClass [
        uq:unqProp <%E6%A4%8D%E7%89%A9#%E5%90%8D>, <%E6%A4%8D%E7%89%A9#%E4%BD%BF%E7%94%A8%E9%83%A8> ;
        uq:unqForClass <%E6%A4%8D%E7%89%A9>
    ] .

# 成分
<%E6%88%90%E5%88%86> a sh:NodeShape , rdfs:Class ;
    sh:property [ sh:maxLength 10 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:maxCount 1 ;
        sh:path <%E6%88%90%E5%88%86#%E7%9A%BF> ] ; 
    sh:property [ sh:maxLength 10 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:maxCount 1 ;
        sh:path <%E6%88%90%E5%88%86#%E6%A4%8D%E7%89%A9%E5%90%8D> ] ; 
    sh:property [ sh:maxLength 10 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
        sh:maxCount 1 ;
        sh:path <%E6%88%90%E5%88%86#%E4%BD%BF%E7%94%A8%E9%83%A8> ] ; 
    sh:property [
        sh:path <%E6%88%90%E5%88%86,%E6%A4%8D%E7%89%A9#%E6%A4%8D%E7%89%A9%E5%90%8D,%E4%BD%BF%E7%94%A8%E9%83%A8,%E5%90%8D,%E4%BD%BF%E7%94%A8%E9%83%A8> ;
        sh:nodeKind sh:IRI;
        sh:maxCount 1 ;
        sh:class <%E6%A4%8D%E7%89%A9>
    ] .

uq:UniqueValuesConstraintComponent
    a sh:ConstraintComponent ;
    sh:parameter [
        sh:path uq:uniqueValuesForClass
    ] ; 
    sh:nodeValidator [
        a sh:SPARQLSelectValidator ;
        sh:select """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX uq: <http://sirius−labs.no/shapes/unique#>

            SELECT $this ?other
            WHERE { 
                FILTER NOT EXISTS {
                    GRAPH $shapesGraph {
                        $uniqueValuesForClass uq:unqProp ?prop
                    }
                    $this ?prop ?thisVal .
                    ?other ?prop ?otherVal .
                    FILTER (?thisVal != ?otherVal)
                }
                FILTER (?other != $this)
                GRAPH $shapesGraph {
                    $uniqueValuesForClass uq:unqForClass ?class
                } 
                ?other rdf:type $class .
            }
        """
    ] .